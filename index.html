
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://rubcstswe.github.io/web102/">
      
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.12">
    
    
      
        <title>WEB102 Server Application Fundamentals</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.2afb09e1.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="WEB102 Server Application Fundamentals" >
      
        <meta  property="og:description"  content="None" >
      
        <meta  property="og:image"  content="https://rubcstswe.github.io/web102/assets/images/social/index.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://rubcstswe.github.io/web102/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="WEB102 Server Application Fundamentals" >
      
        <meta  name="twitter:description"  content="None" >
      
        <meta  name="twitter:image"  content="https://rubcstswe.github.io/web102/assets/images/social/index.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#token-based-email-password" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="WEB102 Server Application Fundamentals" class="md-header__button md-logo" aria-label="WEB102 Server Application Fundamentals" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            WEB102 Server Application Fundamentals
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Token-based (Email &amp; Password )
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5M7 15a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="." class="md-tabs__link">
        
  
  
    
  
  Token-based (Email &amp; Password )

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="WEB102 Server Application Fundamentals" class="md-nav__button md-logo" aria-label="WEB102 Server Application Fundamentals" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    WEB102 Server Application Fundamentals
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Token-based (Email &amp; Password )
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Token-based (Email &amp; Password )
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-you-will-learn-today" class="md-nav__link">
    <span class="md-ellipsis">
      What you will learn today
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Prerequisites">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#assumed-knowledge" class="md-nav__link">
    <span class="md-ellipsis">
      Assumed knowledge
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#development-environment" class="md-nav__link">
    <span class="md-ellipsis">
      Development environment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clone-the-repository" class="md-nav__link">
    <span class="md-ellipsis">
      Clone the repository
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-modelschema" class="md-nav__link">
    <span class="md-ellipsis">
      Data Model/Schema
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rest-api-endpoints" class="md-nav__link">
    <span class="md-ellipsis">
      REST API Endpoints
    </span>
  </a>
  
    <nav class="md-nav" aria-label="REST API Endpoints">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#request" class="md-nav__link">
    <span class="md-ellipsis">
      Request
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response" class="md-nav__link">
    <span class="md-ellipsis">
      Response
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authentication-and-authorization-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication and authorization concepts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authentication and authorization concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authentication-in-web-applications" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication in web applications
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication-and-signuplogin-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication and signup/login flow
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-a-hashpassword-field-to-the-user-model" class="md-nav__link">
    <span class="md-ellipsis">
      Adding a hashPassword field to the User Model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-registration-functionality" class="md-nav__link">
    <span class="md-ellipsis">
      Add registration functionality
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Add registration functionality">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#register-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      Register endpoint
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Register endpoint">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#request-body" class="md-nav__link">
    <span class="md-ellipsis">
      Request Body
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response_1" class="md-nav__link">
    <span class="md-ellipsis">
      Response
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementing-the-register-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      Implementing the register endpoint
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementing the register endpoint">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#handling-exceptions-and-errors-from-prisma-orm" class="md-nav__link">
    <span class="md-ellipsis">
      Handling exceptions and errors from Prisma ORM
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-login-functionaliy" class="md-nav__link">
    <span class="md-ellipsis">
      Add login functionaliy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Add login functionaliy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#login-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      Login endpoint
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Login endpoint">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#request-body_1" class="md-nav__link">
    <span class="md-ellipsis">
      Request Body
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response_2" class="md-nav__link">
    <span class="md-ellipsis">
      Response
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementing-the-login-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      Implementing the login endpoint
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementing the login endpoint">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#handling-the-jwt-token-in-the-login-response" class="md-nav__link">
    <span class="md-ellipsis">
      Handling the JWT token in the login response
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementing-authorization-on-protected-endpoints" class="md-nav__link">
    <span class="md-ellipsis">
      Implementing authorization on protected endpoints
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementing authorization on protected endpoints">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#middleware-for-verifying-jwt-tokens" class="md-nav__link">
    <span class="md-ellipsis">
      Middleware for verifying JWT tokens
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#protected-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      Protected endpoint
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Protected endpoint">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#request-headers" class="md-nav__link">
    <span class="md-ellipsis">
      Request Headers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response_3" class="md-nav__link">
    <span class="md-ellipsis">
      Response
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementing-the-protected-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      Implementing the protected endpoint
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-you-will-learn-today" class="md-nav__link">
    <span class="md-ellipsis">
      What you will learn today
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Prerequisites">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#assumed-knowledge" class="md-nav__link">
    <span class="md-ellipsis">
      Assumed knowledge
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#development-environment" class="md-nav__link">
    <span class="md-ellipsis">
      Development environment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clone-the-repository" class="md-nav__link">
    <span class="md-ellipsis">
      Clone the repository
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-modelschema" class="md-nav__link">
    <span class="md-ellipsis">
      Data Model/Schema
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rest-api-endpoints" class="md-nav__link">
    <span class="md-ellipsis">
      REST API Endpoints
    </span>
  </a>
  
    <nav class="md-nav" aria-label="REST API Endpoints">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#request" class="md-nav__link">
    <span class="md-ellipsis">
      Request
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response" class="md-nav__link">
    <span class="md-ellipsis">
      Response
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authentication-and-authorization-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication and authorization concepts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authentication and authorization concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authentication-in-web-applications" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication in web applications
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication-and-signuplogin-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication and signup/login flow
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-a-hashpassword-field-to-the-user-model" class="md-nav__link">
    <span class="md-ellipsis">
      Adding a hashPassword field to the User Model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-registration-functionality" class="md-nav__link">
    <span class="md-ellipsis">
      Add registration functionality
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Add registration functionality">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#register-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      Register endpoint
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Register endpoint">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#request-body" class="md-nav__link">
    <span class="md-ellipsis">
      Request Body
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response_1" class="md-nav__link">
    <span class="md-ellipsis">
      Response
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementing-the-register-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      Implementing the register endpoint
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementing the register endpoint">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#handling-exceptions-and-errors-from-prisma-orm" class="md-nav__link">
    <span class="md-ellipsis">
      Handling exceptions and errors from Prisma ORM
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-login-functionaliy" class="md-nav__link">
    <span class="md-ellipsis">
      Add login functionaliy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Add login functionaliy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#login-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      Login endpoint
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Login endpoint">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#request-body_1" class="md-nav__link">
    <span class="md-ellipsis">
      Request Body
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response_2" class="md-nav__link">
    <span class="md-ellipsis">
      Response
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementing-the-login-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      Implementing the login endpoint
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementing the login endpoint">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#handling-the-jwt-token-in-the-login-response" class="md-nav__link">
    <span class="md-ellipsis">
      Handling the JWT token in the login response
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementing-authorization-on-protected-endpoints" class="md-nav__link">
    <span class="md-ellipsis">
      Implementing authorization on protected endpoints
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementing authorization on protected endpoints">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#middleware-for-verifying-jwt-tokens" class="md-nav__link">
    <span class="md-ellipsis">
      Middleware for verifying JWT tokens
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#protected-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      Protected endpoint
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Protected endpoint">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#request-headers" class="md-nav__link">
    <span class="md-ellipsis">
      Request Headers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response_3" class="md-nav__link">
    <span class="md-ellipsis">
      Response
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementing-the-protected-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      Implementing the protected endpoint
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="token-based-email-password">Token-based (Email &amp; Password )</h1>
<p>This guided tutorial is part of a series of articles on building an authenticated backend with TypeScript, Hono, PostgreSQL, and Prisma. In this first tutorial, we'll look at how to secure the REST API with password authentication using Prisma for token storage and implement authorization.</p>
<h2 id="what-you-will-learn-today">What you will learn today</h2>
<p>In this tutorial, you will explore the fundamental concepts of authentication and authorization, understand their distinctions, and learn how to implement email-based password authentication and authorization using JSON Web Tokens (JWT) with Hono to secure your REST API.
Specifically, you will develop the following aspects:</p>
<ol>
<li>Password Authentication: Implement a sign-up and login system where users receive a unique token via email. Users complete the authentication process by sending the received token to the API, which then issues a long-lived JWT token granting access to authenticated API endpoints.</li>
<li>Authorization: Incorporate authorization logic to control which resources authenticated users can access and manipulate based on their roles or permissions.</li>
</ol>
<h2 id="prerequisites">Prerequisites</h2>
<h3 id="assumed-knowledge">Assumed knowledge</h3>
<p>This tutorial assumes a basic understanding of TypeScript, Node.js, and relational databases. If you're proficient in JavaScript but new to TypeScript, you can still follow along comfortably. The tutorial series will utilize PostgreSQL, but most of the concepts are applicable to other relational databases such as MySQL. Familiarity with REST principles is advantageous. Some prior knowledge of Prisma is required.</p>
<h3 id="development-environment">Development environment</h3>
<p>Ensure you have the following tools installed on your machine:</p>
<ul>
<li><a href="https://bun.sh/">Bun</a> v 1.x or later</li>
</ul>
<p>If you're using Visual Studio Code, the Prisma extension is recommended for syntax highlighting, formatting, and other helpers.</p>
<h2 id="clone-the-repository">Clone the repository</h2>
<p>The source code for the tutorial can be found on [GitHub].</p>
<p>To get started, clone the repository and install the dependencies:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/rubcstswe/web102-hono-auth-jwt-prisma-forked.git
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="nb">cd</span><span class="w"> </span>web102-hono-auth-jwt-prisma-forked
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>bun<span class="w"> </span>install
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The repository has already implemented a basic REST API with Hono and Prisma. The API includes a user model and a few endpoints to create, read, update, and delete users. The API is not secured and can be accessed without authentication.</p>
</div>
<h2 id="data-modelschema">Data Model/Schema</h2>
<p>The fundamental building block of the Prisma schema is <a href="https://www.prisma.io/docs/orm/prisma-schema/data-model/models">model</a>. Every model maps to a database table.</p>
<p>Here is a basic schema showing the basic bank account in a 1-n relationship to a user from the project repository that you have cloned:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">schema.prisma</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span>
<span class="normal"><a href="#__codelineno-1-16">16</a></span>
<span class="normal"><a href="#__codelineno-1-17">17</a></span>
<span class="normal"><a href="#__codelineno-1-18">18</a></span>
<span class="normal"><a href="#__codelineno-1-19">19</a></span>
<span class="normal"><a href="#__codelineno-1-20">20</a></span>
<span class="normal"><a href="#__codelineno-1-21">21</a></span>
<span class="normal"><a href="#__codelineno-1-22">22</a></span>
<span class="normal"><a href="#__codelineno-1-23">23</a></span>
<span class="normal"><a href="#__codelineno-1-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-13" name="__codelineno-1-13"></a>model User {
<a id="__codelineno-1-14" name="__codelineno-1-14"></a>  id      String    @id @default(uuid())
<a id="__codelineno-1-15" name="__codelineno-1-15"></a>  email   String    @unique
<a id="__codelineno-1-16" name="__codelineno-1-16"></a>  Account Account[]
<a id="__codelineno-1-17" name="__codelineno-1-17"></a>}
<a id="__codelineno-1-18" name="__codelineno-1-18"></a>
<a id="__codelineno-1-19" name="__codelineno-1-19"></a>model Account {
<a id="__codelineno-1-20" name="__codelineno-1-20"></a>  id      String @id @default(uuid())
<a id="__codelineno-1-21" name="__codelineno-1-21"></a>  userId  String
<a id="__codelineno-1-22" name="__codelineno-1-22"></a>  user    User   @relation(fields: [userId], references: [id])
<a id="__codelineno-1-23" name="__codelineno-1-23"></a>  balance Int    @default(0)
<a id="__codelineno-1-24" name="__codelineno-1-24"></a>}
</code></pre></div></td></tr></table></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>User</code> model has a one-to-many relationship with the <code>Account</code> model. A user can have multiple accounts, but an account belongs to only one user.</p>
</div>
<h2 id="rest-api-endpoints">REST API Endpoints</h2>
<table>
<thead>
<tr>
<th style="text-align: left;">Method</th>
<th style="text-align: left;">Endpoint</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>GET</code></td>
<td style="text-align: left;"><code>http://localhost:3000/:userId/account/balance</code></td>
<td style="text-align: left;">Retrieves all accounts owned by the user with its' balance</td>
</tr>
</tbody>
</table>
<p>Where the user id is given as <code>7a038d5b-65aa-45c5-9f7e-c9b86a071099</code></p>
<p>Let's build a http request to get the balance of the account of the user with the id <code>7a038d5b-65aa-45c5-9f7e-c9b86a071099</code></p>
<h3 id="request">Request</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="err">http://localhost:3000/7a038d5b-65aa-45c5-9f7e-c9b86a071099/account/balance</span>
</code></pre></div>
<h3 id="response">Response</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="p">{</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">  </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">    </span><span class="nt">&quot;Account&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">      </span><span class="p">{</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">        </span><span class="nt">&quot;balance&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">        </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;75a34064-f8c4-4a7e-90dd-4958c452fbf4&quot;</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">    </span><span class="p">]</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="p">}</span>
</code></pre></div>
<div class="admonition question">
<p class="admonition-title">Question</p>
<p>Should anyone be able to access and view any user's bank account balance?</p>
<p>If you realised that the API is not secured and can be accessed without authentication, you are right! </p>
<p>Technically, only the user who owns the account should be able to access the account balance.</p>
<p>In the next step, we will implement a password authentication system using Prisma for token storage and implement authorization.</p>
</div>
<h2 id="authentication-and-authorization-concepts">Authentication and authorization concepts</h2>
<p>Before going into the implementation, let's explore the concepts of authentication and authorization. While these terms are often used interchangeably, they serve distinct purposes and work together to secure applications.</p>
<p><strong>Authentication</strong> is the process of verifying a user's identity. In other words, it answers the question "Who are you?" One real-world example of authentication is a valid passport. By matching your appearance with the official document's photo and details (which are difficult to forge), your passport authenticates that you are the person you claim to be. When you arrive at the airport, presenting your passport allows you to proceed through security.</p>
<p>On the other hand, <strong>authorization</strong> is the process of verifying what resources or actions a user is permitted to access or perform. It answers the question "What are you allowed to do?" Continuing with the airport example, authorization occurs when you present your boarding pass (which is typically scanned and verified against the flight's passenger database). The ground attendant then authorizes you to board the flight.</p>
<p>In summary, authentication establishes identity, while authorization determines access privileges. These complementary processes work together to secure applications and ensure that only authenticated users can access the resources and perform the actions they are authorized for.</p>
<h3 id="authentication-in-web-applications">Authentication in web applications</h3>
<p>Web applications typically use a username and password to authenticate users. If a valid username and password are verified and correct, the server can verify that you're the user you claim to be because the password is supposed to be only known to you and the application.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Web applications that use username/password authentication rarely store the password in clear text in the database. Instead, they use a technique called hashing to store a hash of the password. This allows the backend to verify the password without knowing it.</p>
<p>A hash function is a mathematical function that takes arbitrary input and always generates the same fixed-length string/number given the same input. The power of hash function lies in that you can go from a password to a hash but not from a hash to a password.</p>
<p>This allows verifying the password submitted by the user without storing the actual password. Storing password hashes protects users in the case of breached accounts.</p>
</div>
<h3 id="authentication-and-signuplogin-flow">Authentication and signup/login flow</h3>
<p>Email-based password authentication is a two-step process.</p>
<ol>
<li>
<p><strong>Register</strong>: The user provides an email and password to create an account. The server stores the user's email and a hashed password in the database.</p>
</li>
<li>
<p><strong>Login</strong>: The user provides their email and password to authenticate themselves. The server verifies the email and password against the stored hash. If the credentials are correct, the server issues a long-lived JWT token that the user can use to access authenticated API endpoints.</p>
</li>
</ol>
<p>A successful authentication flow will look as follows:</p>
<pre class="mermaid"><code>sequenceDiagram
  autonumber
  User-&gt;&gt;Server: register {email, password}
  Server-&gt;&gt;Database: Create user (if new/doesnt exist)
  Server--&gt;&gt;User: HTTP 200 OK {message: "User created successfully"}
  User-&gt;&gt;Server: login {email, password}
  Server--&gt;&gt;Database: Verify if email is in the database and the password matches the stored hash
  Server--&gt;&gt;User: JWT token sent back in authorization header
  User-&gt;&gt;Server: User passes JWT auth token in the authorization header in subsequent requests</code></pre>
<ol>
<li>The user calls the /register endpoint in the API with the email and password in the payload to begin the registration process.</li>
<li>If the email is new, the user is created in the User table and the password is hashed and stored in the database.</li>
<li>he user calls the /login endpoint in the API with the email and password in the payload to begin the authentication process.</li>
<li>The backend validates the email and password sent by the user. If the email exists and the password matches the stored hash, the user is authenticated.</li>
<li>The JWT token is sent back to the user via the Authorization header.</li>
</ol>
<p><strong>Authentication token</strong>: A JWT token with tokenId in its payload. This token can be used to access protected endpoints by passing it in the Authorization header when making a request to the API. The token is long-lived in the sense that it's valid for 12 hours at least.</p>
<h2 id="adding-a-hashpassword-field-to-the-user-model">Adding a hashPassword field to the User Model</h2>
<p>To store the hashed password, we need to add a new field called <code>hashPassword</code> to the User model in the Prisma schema. This field will store the hashed password.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">schema.prisma</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-13">13</a></span>
<span class="normal"><a href="#__codelineno-4-14">14</a></span>
<span class="normal"><a href="#__codelineno-4-15">15</a></span>
<span class="normal"><a href="#__codelineno-4-16">16</a></span>
<span class="normal"><a href="#__codelineno-4-17">17</a></span>
<span class="normal"><a href="#__codelineno-4-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-13" name="__codelineno-4-13"></a>model User {
<a id="__codelineno-4-14" name="__codelineno-4-14"></a>  id           String    @id @default(uuid())
<a id="__codelineno-4-15" name="__codelineno-4-15"></a>  email        String    @unique
<a id="__codelineno-4-16" name="__codelineno-4-16"></a><span class="hll">  hashPassword String
</span><a id="__codelineno-4-17" name="__codelineno-4-17"></a>  Account      Account[]
<a id="__codelineno-4-18" name="__codelineno-4-18"></a>}
</code></pre></div></td></tr></table></div>
<p>To update the database schema, run the commands as follows:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>bunx<span class="w"> </span>prisma<span class="w"> </span>db<span class="w"> </span>push
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>bunx<span class="w"> </span>prisma<span class="w"> </span>generate
</code></pre></div>
<h2 id="add-registration-functionality">Add registration functionality</h2>
<p>To implement the registration functionality, we need to create a new endpoint that allows users to register by providing an email and password. The server will hash the password and store the email and hashed password in the database.</p>
<h3 id="register-endpoint">Register endpoint</h3>
<p>The register endpoint is a POST request that accepts an email and password in the request body. The server will hash the password and store the email and hashed password in the database.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="err">POST http://localhost:3000/register</span>
</code></pre></div>
<h4 id="request-body">Request Body</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="p">{</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">    </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;test@gmail.com&quot;</span><span class="p">,</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">    </span><span class="nt">&quot;password&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;123456&quot;</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="p">}</span>
</code></pre></div>
<h4 id="response_1">Response</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="p">{</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">    </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;User created successfully&quot;</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="p">}</span>
</code></pre></div>
<h3 id="implementing-the-register-endpoint">Implementing the register endpoint</h3>
<p>To implement the register endpoint, we need to create a new route in the <code>src/index.ts</code> file.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">src/index.ts</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-23">23</a></span>
<span class="normal"><a href="#__codelineno-9-24">24</a></span>
<span class="normal"><a href="#__codelineno-9-25">25</a></span>
<span class="normal"><a href="#__codelineno-9-26">26</a></span>
<span class="normal"><a href="#__codelineno-9-27">27</a></span>
<span class="normal"><a href="#__codelineno-9-28">28</a></span>
<span class="normal"><a href="#__codelineno-9-29">29</a></span>
<span class="normal"><a href="#__codelineno-9-30">30</a></span>
<span class="normal"><a href="#__codelineno-9-31">31</a></span>
<span class="normal"><a href="#__codelineno-9-32">32</a></span>
<span class="normal"><a href="#__codelineno-9-33">33</a></span>
<span class="normal"><a href="#__codelineno-9-34">34</a></span>
<span class="normal"><a href="#__codelineno-9-35">35</a></span>
<span class="normal"><a href="#__codelineno-9-36">36</a></span>
<span class="normal"><a href="#__codelineno-9-37">37</a></span>
<span class="normal"><a href="#__codelineno-9-38">38</a></span>
<span class="normal"><a href="#__codelineno-9-39">39</a></span>
<span class="normal"><a href="#__codelineno-9-40">40</a></span>
<span class="normal"><a href="#__codelineno-9-41">41</a></span>
<span class="normal"><a href="#__codelineno-9-42">42</a></span>
<span class="normal"><a href="#__codelineno-9-43">43</a></span>
<span class="normal"><a href="#__codelineno-9-44">44</a></span>
<span class="normal"><a href="#__codelineno-9-45">45</a></span>
<span class="normal"><a href="#__codelineno-9-46">46</a></span>
<span class="normal"><a href="#__codelineno-9-47">47</a></span>
<span class="normal"><a href="#__codelineno-9-48">48</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-23" name="__codelineno-9-23"></a><span class="hll"><span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">&quot;/register&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-9-24" name="__codelineno-9-24"></a><span class="hll"><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-9-25" name="__codelineno-9-25"></a><span class="hll"><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">req</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
</span><a id="__codelineno-9-26" name="__codelineno-9-26"></a><span class="hll">
</span><a id="__codelineno-9-27" name="__codelineno-9-27"></a><span class="hll"><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">bcryptHash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">Bun</span><span class="p">.</span><span class="nx">password</span><span class="p">.</span><span class="nx">hash</span><span class="p">(</span><span class="nx">body</span><span class="p">.</span><span class="nx">password</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-9-28" name="__codelineno-9-28"></a><span class="hll"><span class="w">      </span><span class="nx">algorithm</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;bcrypt&quot;</span><span class="p">,</span>
</span><a id="__codelineno-9-29" name="__codelineno-9-29"></a><span class="hll"><span class="w">      </span><span class="nx">cost</span><span class="o">:</span><span class="w"> </span><span class="kt">4</span><span class="p">,</span><span class="w"> </span><span class="c1">// number between 4-31</span>
</span><a id="__codelineno-9-30" name="__codelineno-9-30"></a><span class="hll"><span class="w">    </span><span class="p">});</span>
</span><a id="__codelineno-9-31" name="__codelineno-9-31"></a><span class="hll">
</span><a id="__codelineno-9-32" name="__codelineno-9-32"></a><span class="hll"><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
</span><a id="__codelineno-9-33" name="__codelineno-9-33"></a><span class="hll"><span class="w">      </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-9-34" name="__codelineno-9-34"></a><span class="hll"><span class="w">        </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="kt">body.email</span><span class="p">,</span>
</span><a id="__codelineno-9-35" name="__codelineno-9-35"></a><span class="hll"><span class="w">        </span><span class="nx">hashedPassword</span><span class="o">:</span><span class="w"> </span><span class="kt">bcryptHash</span><span class="p">,</span>
</span><a id="__codelineno-9-36" name="__codelineno-9-36"></a><span class="hll"><span class="w">        </span><span class="nx">Account</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-9-37" name="__codelineno-9-37"></a><span class="hll"><span class="w">          </span><span class="nx">create</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-9-38" name="__codelineno-9-38"></a><span class="hll"><span class="w">            </span><span class="nx">balance</span><span class="o">:</span><span class="w"> </span><span class="kt">0</span><span class="p">,</span>
</span><a id="__codelineno-9-39" name="__codelineno-9-39"></a><span class="hll"><span class="w">          </span><span class="p">},</span>
</span><a id="__codelineno-9-40" name="__codelineno-9-40"></a><span class="hll"><span class="w">        </span><span class="p">},</span>
</span><a id="__codelineno-9-41" name="__codelineno-9-41"></a><span class="hll"><span class="w">      </span><span class="p">},</span>
</span><a id="__codelineno-9-42" name="__codelineno-9-42"></a><span class="hll"><span class="w">    </span><span class="p">});</span>
</span><a id="__codelineno-9-43" name="__codelineno-9-43"></a><span class="hll">
</span><a id="__codelineno-9-44" name="__codelineno-9-44"></a><span class="hll"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">user</span><span class="p">.</span><span class="nx">email</span><span class="si">}</span><span class="sb"> created successfully}`</span><span class="w"> </span><span class="p">});</span>
</span><a id="__codelineno-9-45" name="__codelineno-9-45"></a><span class="hll"><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-9-46" name="__codelineno-9-46"></a><span class="hll"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">});</span>
</span><a id="__codelineno-9-47" name="__codelineno-9-47"></a><span class="hll"><span class="w">  </span><span class="p">}</span>
</span><a id="__codelineno-9-48" name="__codelineno-9-48"></a><span class="hll"><span class="p">});</span>
</span></code></pre></div></td></tr></table></div>
<ol>
<li>The route listens for POST requests to the <code>/register</code> endpoint.</li>
<li>The request body is parsed to extract the email and password.</li>
<li>The password is hashed using the <code>Bun.password.hash</code> method.</li>
<li>The user is created in the database with the email and hashed password.</li>
<li>The <code>Account</code> model is created with a default balance of 0.</li>
<li>A success message is returned if the user is created successfully.</li>
<li>If an error occurs during the registration process, the server returns a JSON response with the error message.</li>
</ol>
<h4 id="handling-exceptions-and-errors-from-prisma-orm">Handling exceptions and errors from Prisma ORM</h4>
<p>In the code snippet above, we use a try-catch block to handle exceptions and errors that may occur during the registration process. If an error occurs, the server will return a JSON response with the error message.</p>
<p>However, we need to know the exact error that occurred. To do this, we can use the <code>PrismaClientKnownRequestError</code> class to check if the error is a known Prisma error. If it is, we can return a more user-friendly error message.</p>
<div class="highlight"><span class="filename">src/index.ts</span><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Hono</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;hono&quot;</span><span class="p">;</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">cors</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;hono/cors&quot;</span><span class="p">;</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="hll"><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">PrismaClient</span><span class="p">,</span><span class="w"> </span><span class="nx">Prisma</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@prisma/client&quot;</span><span class="p">;</span>
</span></code></pre></div>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">src/index.ts</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-23">23</a></span>
<span class="normal"><a href="#__codelineno-11-24">24</a></span>
<span class="normal"><a href="#__codelineno-11-25">25</a></span>
<span class="normal"><a href="#__codelineno-11-26">26</a></span>
<span class="normal"><a href="#__codelineno-11-27">27</a></span>
<span class="normal"><a href="#__codelineno-11-28">28</a></span>
<span class="normal"><a href="#__codelineno-11-29">29</a></span>
<span class="normal"><a href="#__codelineno-11-30">30</a></span>
<span class="normal"><a href="#__codelineno-11-31">31</a></span>
<span class="normal"><a href="#__codelineno-11-32">32</a></span>
<span class="normal"><a href="#__codelineno-11-33">33</a></span>
<span class="normal"><a href="#__codelineno-11-34">34</a></span>
<span class="normal"><a href="#__codelineno-11-35">35</a></span>
<span class="normal"><a href="#__codelineno-11-36">36</a></span>
<span class="normal"><a href="#__codelineno-11-37">37</a></span>
<span class="normal"><a href="#__codelineno-11-38">38</a></span>
<span class="normal"><a href="#__codelineno-11-39">39</a></span>
<span class="normal"><a href="#__codelineno-11-40">40</a></span>
<span class="normal"><a href="#__codelineno-11-41">41</a></span>
<span class="normal"><a href="#__codelineno-11-42">42</a></span>
<span class="normal"><a href="#__codelineno-11-43">43</a></span>
<span class="normal"><a href="#__codelineno-11-44">44</a></span>
<span class="normal"><a href="#__codelineno-11-45">45</a></span>
<span class="normal"><a href="#__codelineno-11-46">46</a></span>
<span class="normal"><a href="#__codelineno-11-47">47</a></span>
<span class="normal"><a href="#__codelineno-11-48">48</a></span>
<span class="normal"><a href="#__codelineno-11-49">49</a></span>
<span class="normal"><a href="#__codelineno-11-50">50</a></span>
<span class="normal"><a href="#__codelineno-11-51">51</a></span>
<span class="normal"><a href="#__codelineno-11-52">52</a></span>
<span class="normal"><a href="#__codelineno-11-53">53</a></span>
<span class="normal"><a href="#__codelineno-11-54">54</a></span>
<span class="normal"><a href="#__codelineno-11-55">55</a></span>
<span class="normal"><a href="#__codelineno-11-56">56</a></span>
<span class="normal"><a href="#__codelineno-11-57">57</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-23" name="__codelineno-11-23"></a><span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">&quot;/register&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-24" name="__codelineno-11-24"></a><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-25" name="__codelineno-11-25"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">req</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<a id="__codelineno-11-26" name="__codelineno-11-26"></a>
<a id="__codelineno-11-27" name="__codelineno-11-27"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">bcryptHash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">Bun</span><span class="p">.</span><span class="nx">password</span><span class="p">.</span><span class="nx">hash</span><span class="p">(</span><span class="nx">body</span><span class="p">.</span><span class="nx">password</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-28" name="__codelineno-11-28"></a><span class="w">      </span><span class="nx">algorithm</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;bcrypt&quot;</span><span class="p">,</span>
<a id="__codelineno-11-29" name="__codelineno-11-29"></a><span class="w">      </span><span class="nx">cost</span><span class="o">:</span><span class="w"> </span><span class="kt">4</span><span class="p">,</span><span class="w"> </span><span class="c1">// number between 4-31</span>
<a id="__codelineno-11-30" name="__codelineno-11-30"></a><span class="w">    </span><span class="p">});</span>
<a id="__codelineno-11-31" name="__codelineno-11-31"></a>
<a id="__codelineno-11-32" name="__codelineno-11-32"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<a id="__codelineno-11-33" name="__codelineno-11-33"></a><span class="w">      </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-34" name="__codelineno-11-34"></a><span class="w">        </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="kt">body.email</span><span class="p">,</span>
<a id="__codelineno-11-35" name="__codelineno-11-35"></a><span class="w">        </span><span class="nx">hashedPassword</span><span class="o">:</span><span class="w"> </span><span class="kt">bcryptHash</span><span class="p">,</span>
<a id="__codelineno-11-36" name="__codelineno-11-36"></a><span class="w">        </span><span class="nx">Account</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-37" name="__codelineno-11-37"></a><span class="w">          </span><span class="nx">create</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-38" name="__codelineno-11-38"></a><span class="w">            </span><span class="nx">balance</span><span class="o">:</span><span class="w"> </span><span class="kt">0</span><span class="p">,</span>
<a id="__codelineno-11-39" name="__codelineno-11-39"></a><span class="w">          </span><span class="p">},</span>
<a id="__codelineno-11-40" name="__codelineno-11-40"></a><span class="w">        </span><span class="p">},</span>
<a id="__codelineno-11-41" name="__codelineno-11-41"></a><span class="w">      </span><span class="p">},</span>
<a id="__codelineno-11-42" name="__codelineno-11-42"></a><span class="w">    </span><span class="p">});</span>
<a id="__codelineno-11-43" name="__codelineno-11-43"></a>
<a id="__codelineno-11-44" name="__codelineno-11-44"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">user</span><span class="p">.</span><span class="nx">email</span><span class="si">}</span><span class="sb"> created successfully}`</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-11-45" name="__codelineno-11-45"></a><span class="hll"><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-11-46" name="__codelineno-11-46"></a><span class="hll"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">Prisma</span><span class="p">.</span><span class="nx">PrismaClientKnownRequestError</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-11-47" name="__codelineno-11-47"></a><span class="hll"><span class="w">      </span><span class="c1">// The .code property can be accessed in a type-safe manner</span>
</span><a id="__codelineno-11-48" name="__codelineno-11-48"></a><span class="hll"><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">code</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;P2002&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-11-49" name="__codelineno-11-49"></a><span class="hll"><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
</span><a id="__codelineno-11-50" name="__codelineno-11-50"></a><span class="hll"><span class="w">          </span><span class="s1">&#39;There is a unique constraint violation, a new user cannot be created with this email&#39;</span>
</span><a id="__codelineno-11-51" name="__codelineno-11-51"></a><span class="hll"><span class="w">        </span><span class="p">)</span>
</span><a id="__codelineno-11-52" name="__codelineno-11-52"></a><span class="hll"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Email already exists&#39;</span><span class="w"> </span><span class="p">})</span>
</span><a id="__codelineno-11-53" name="__codelineno-11-53"></a><span class="hll"><span class="w">      </span><span class="p">}</span>
</span><a id="__codelineno-11-54" name="__codelineno-11-54"></a><span class="hll"><span class="w">    </span><span class="p">}</span>
</span><a id="__codelineno-11-55" name="__codelineno-11-55"></a><span class="hll"><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="nx">e</span>
</span><a id="__codelineno-11-56" name="__codelineno-11-56"></a><span class="hll"><span class="w">  </span><span class="p">}</span>
</span><a id="__codelineno-11-57" name="__codelineno-11-57"></a><span class="hll"><span class="p">});</span>
</span></code></pre></div></td></tr></table></div>
<h2 id="add-login-functionaliy">Add login functionaliy</h2>
<p>To implement the login functionality, we need to create a new endpoint that allows users to authenticate by providing an email and password. The server will verify the email and password against the stored hash. If the credentials are correct, the server will issue a long-lived JWT token that the user can use to access authenticated API endpoints.</p>
<h3 id="login-endpoint">Login endpoint</h3>
<p>The login endpoint is a POST request that accepts an email and password in the request body. The server will verify the email and password against the stored hash. If the credentials are correct, the server will issue a long-lived JWT token that the user can use to access authenticated API endpoints.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="err">POST http://localhost:3000/login</span>
</code></pre></div>
<h4 id="request-body_1">Request Body</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="p">{</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">    </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;test@gmail.com&quot;</span><span class="p">,</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">    </span><span class="nt">&quot;password&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;123456&quot;</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="p">}</span>
</code></pre></div>
<h4 id="response_2">Response</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="p">{</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">    </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Login successful&quot;</span><span class="p">,</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w">    </span><span class="nt">&quot;token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;JWT_TOKEN_LIVES_HERE&quot;</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="p">}</span>
</code></pre></div>
<h3 id="implementing-the-login-endpoint">Implementing the login endpoint</h3>
<p>To implement the login endpoint, we need to create a new route in the <code>src/index.ts</code> file.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">src/index.ts</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-58">58</a></span>
<span class="normal"><a href="#__codelineno-15-59">59</a></span>
<span class="normal"><a href="#__codelineno-15-60">60</a></span>
<span class="normal"><a href="#__codelineno-15-61">61</a></span>
<span class="normal"><a href="#__codelineno-15-62">62</a></span>
<span class="normal"><a href="#__codelineno-15-63">63</a></span>
<span class="normal"><a href="#__codelineno-15-64">64</a></span>
<span class="normal"><a href="#__codelineno-15-65">65</a></span>
<span class="normal"><a href="#__codelineno-15-66">66</a></span>
<span class="normal"><a href="#__codelineno-15-67">67</a></span>
<span class="normal"><a href="#__codelineno-15-68">68</a></span>
<span class="normal"><a href="#__codelineno-15-69">69</a></span>
<span class="normal"><a href="#__codelineno-15-70">70</a></span>
<span class="normal"><a href="#__codelineno-15-71">71</a></span>
<span class="normal"><a href="#__codelineno-15-72">72</a></span>
<span class="normal"><a href="#__codelineno-15-73">73</a></span>
<span class="normal"><a href="#__codelineno-15-74">74</a></span>
<span class="normal"><a href="#__codelineno-15-75">75</a></span>
<span class="normal"><a href="#__codelineno-15-76">76</a></span>
<span class="normal"><a href="#__codelineno-15-77">77</a></span>
<span class="normal"><a href="#__codelineno-15-78">78</a></span>
<span class="normal"><a href="#__codelineno-15-79">79</a></span>
<span class="normal"><a href="#__codelineno-15-80">80</a></span>
<span class="normal"><a href="#__codelineno-15-81">81</a></span>
<span class="normal"><a href="#__codelineno-15-82">82</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-58" name="__codelineno-15-58"></a><span class="hll"><span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">&quot;/login&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-15-59" name="__codelineno-15-59"></a><span class="hll"><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-15-60" name="__codelineno-15-60"></a><span class="hll"><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">req</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
</span><a id="__codelineno-15-61" name="__codelineno-15-61"></a><span class="hll">
</span><a id="__codelineno-15-62" name="__codelineno-15-62"></a><span class="hll"><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">findUnique</span><span class="p">({</span>
</span><a id="__codelineno-15-63" name="__codelineno-15-63"></a><span class="hll"><span class="w">      </span><span class="nx">where</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="kt">body.email</span><span class="w"> </span><span class="p">},</span>
</span><a id="__codelineno-15-64" name="__codelineno-15-64"></a><span class="hll"><span class="w">      </span><span class="nx">select</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span><span class="w"> </span><span class="nx">hashedPassword</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="w"> </span><span class="p">},</span>
</span><a id="__codelineno-15-65" name="__codelineno-15-65"></a><span class="hll"><span class="w">    </span><span class="p">});</span>
</span><a id="__codelineno-15-66" name="__codelineno-15-66"></a><span class="hll">
</span><a id="__codelineno-15-67" name="__codelineno-15-67"></a><span class="hll"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-15-68" name="__codelineno-15-68"></a><span class="hll"><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;User not found&quot;</span><span class="w"> </span><span class="p">});</span>
</span><a id="__codelineno-15-69" name="__codelineno-15-69"></a><span class="hll"><span class="w">    </span><span class="p">}</span>
</span><a id="__codelineno-15-70" name="__codelineno-15-70"></a><span class="hll">
</span><a id="__codelineno-15-71" name="__codelineno-15-71"></a><span class="hll"><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">match</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">Bun</span><span class="p">.</span><span class="nx">password</span><span class="p">.</span><span class="nx">verify</span><span class="p">(</span><span class="nx">body</span><span class="p">.</span><span class="nx">password</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">hashedPassword</span><span class="p">,</span><span class="s2">&quot;bcrypt&quot;</span><span class="p">);</span>
</span><a id="__codelineno-15-72" name="__codelineno-15-72"></a><span class="hll">
</span><a id="__codelineno-15-73" name="__codelineno-15-73"></a><span class="hll"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">match</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-15-74" name="__codelineno-15-74"></a><span class="hll"><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Login successful&quot;</span><span class="w"> </span><span class="p">});</span>
</span><a id="__codelineno-15-75" name="__codelineno-15-75"></a><span class="hll"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-15-76" name="__codelineno-15-76"></a><span class="hll"><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">HTTPException</span><span class="p">(</span><span class="mf">401</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Invalid credentials&quot;</span><span class="w"> </span><span class="p">});</span>
</span><a id="__codelineno-15-77" name="__codelineno-15-77"></a><span class="hll"><span class="w">    </span><span class="p">}</span>
</span><a id="__codelineno-15-78" name="__codelineno-15-78"></a><span class="hll">
</span><a id="__codelineno-15-79" name="__codelineno-15-79"></a><span class="hll"><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-15-80" name="__codelineno-15-80"></a><span class="hll"><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">HTTPException</span><span class="p">(</span><span class="mf">401</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Invalid credentials&#39;</span><span class="w"> </span><span class="p">})</span>
</span><a id="__codelineno-15-81" name="__codelineno-15-81"></a><span class="hll"><span class="w">  </span><span class="p">}</span>
</span><a id="__codelineno-15-82" name="__codelineno-15-82"></a><span class="hll"><span class="p">});</span>
</span></code></pre></div></td></tr></table></div>
<ol>
<li>The route listens for POST requests to the <code>/login</code> endpoint.</li>
<li>The request body is parsed to extract the email and password.</li>
<li>The user is fetched from the database using the email.</li>
<li>If the user is not found, the server returns a JSON response with the message "User not found".</li>
<li>The password is verified against the stored hash using the <code>Bun.password.verify</code> method.</li>
<li>If the password matches the stored hash, the server returns a JSON response with the message "Login successful".</li>
<li>If the password does not match the stored hash, the server throws an HTTPException with a status code of 401 and a message "Invalid credentials".</li>
</ol>
<p>To do this we need to import the <code>HTTPException</code> class from Hono.</p>
<div class="highlight"><span class="filename">src/index.ts</span><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Hono</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;hono&quot;</span><span class="p">;</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">cors</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;hono/cors&quot;</span><span class="p">;</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">PrismaClient</span><span class="p">,</span><span class="w"> </span><span class="nx">Prisma</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@prisma/client&quot;</span><span class="p">;</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="hll"><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">HTTPException</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;hono/http-exception&quot;</span><span class="p">;</span>
</span></code></pre></div>
<ol>
<li>If an error occurs during the login process, the server returns a JSON response with the message "Login failed".</li>
</ol>
<h4 id="handling-the-jwt-token-in-the-login-response">Handling the JWT token in the login response</h4>
<p>In the code snippet above, we verify the password against the stored hash. If the password matches the stored hash, the server returns a JSON response with the message "Login successful".</p>
<p>However, we need to issue a long-lived JWT token that the user can use to access authenticated API endpoints. </p>
<p>To do this, we can use the JWT Authentication Helper from Hono. The helper provides methods to create and verify JWT tokens. </p>
<p>To use this helper, you can import it as follows:</p>
<div class="highlight"><span class="filename">src/index.ts</span><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Hono</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;hono&quot;</span><span class="p">;</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">cors</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;hono/cors&quot;</span><span class="p">;</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">PrismaClient</span><span class="p">,</span><span class="w"> </span><span class="nx">Prisma</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@prisma/client&quot;</span><span class="p">;</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">HTTPException</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;hono/http-exception&quot;</span><span class="p">;</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="hll"><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">decode</span><span class="p">,</span><span class="w"> </span><span class="nx">sign</span><span class="p">,</span><span class="w"> </span><span class="nx">verify</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;hono/jwt&#39;</span>
</span></code></pre></div>
<p>Next, we can create a JWT token with the user's unique id as the payload and sign it with a secret key. The token can be sent back to the user in the login response.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">src/index.ts</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-58">58</a></span>
<span class="normal"><a href="#__codelineno-18-59">59</a></span>
<span class="normal"><a href="#__codelineno-18-60">60</a></span>
<span class="normal"><a href="#__codelineno-18-61">61</a></span>
<span class="normal"><a href="#__codelineno-18-62">62</a></span>
<span class="normal"><a href="#__codelineno-18-63">63</a></span>
<span class="normal"><a href="#__codelineno-18-64">64</a></span>
<span class="normal"><a href="#__codelineno-18-65">65</a></span>
<span class="normal"><a href="#__codelineno-18-66">66</a></span>
<span class="normal"><a href="#__codelineno-18-67">67</a></span>
<span class="normal"><a href="#__codelineno-18-68">68</a></span>
<span class="normal"><a href="#__codelineno-18-69">69</a></span>
<span class="normal"><a href="#__codelineno-18-70">70</a></span>
<span class="normal"><a href="#__codelineno-18-71">71</a></span>
<span class="normal"><a href="#__codelineno-18-72">72</a></span>
<span class="normal"><a href="#__codelineno-18-73">73</a></span>
<span class="normal"><a href="#__codelineno-18-74">74</a></span>
<span class="normal"><a href="#__codelineno-18-75">75</a></span>
<span class="normal"><a href="#__codelineno-18-76">76</a></span>
<span class="normal"><a href="#__codelineno-18-77">77</a></span>
<span class="normal"><a href="#__codelineno-18-78">78</a></span>
<span class="normal"><a href="#__codelineno-18-79">79</a></span>
<span class="normal"><a href="#__codelineno-18-80">80</a></span>
<span class="normal"><a href="#__codelineno-18-81">81</a></span>
<span class="normal"><a href="#__codelineno-18-82">82</a></span>
<span class="normal"><a href="#__codelineno-18-83">83</a></span>
<span class="normal"><a href="#__codelineno-18-84">84</a></span>
<span class="normal"><a href="#__codelineno-18-85">85</a></span>
<span class="normal"><a href="#__codelineno-18-86">86</a></span>
<span class="normal"><a href="#__codelineno-18-87">87</a></span>
<span class="normal"><a href="#__codelineno-18-88">88</a></span>
<span class="normal"><a href="#__codelineno-18-89">89</a></span>
<span class="normal"><a href="#__codelineno-18-90">90</a></span>
<span class="normal"><a href="#__codelineno-18-91">91</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-58" name="__codelineno-18-58"></a><span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">&quot;/login&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-59" name="__codelineno-18-59"></a><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-60" name="__codelineno-18-60"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">req</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<a id="__codelineno-18-61" name="__codelineno-18-61"></a>
<a id="__codelineno-18-62" name="__codelineno-18-62"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">findUnique</span><span class="p">({</span>
<a id="__codelineno-18-63" name="__codelineno-18-63"></a><span class="w">      </span><span class="nx">where</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="kt">body.email</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-18-64" name="__codelineno-18-64"></a><span class="w">      </span><span class="nx">select</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span><span class="w"> </span><span class="nx">hashedPassword</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-18-65" name="__codelineno-18-65"></a><span class="w">    </span><span class="p">});</span>
<a id="__codelineno-18-66" name="__codelineno-18-66"></a>
<a id="__codelineno-18-67" name="__codelineno-18-67"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-68" name="__codelineno-18-68"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;User not found&quot;</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-18-69" name="__codelineno-18-69"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-18-70" name="__codelineno-18-70"></a>
<a id="__codelineno-18-71" name="__codelineno-18-71"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">match</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">Bun</span><span class="p">.</span><span class="nx">password</span><span class="p">.</span><span class="nx">verify</span><span class="p">(</span>
<a id="__codelineno-18-72" name="__codelineno-18-72"></a><span class="w">      </span><span class="nx">body</span><span class="p">.</span><span class="nx">password</span><span class="p">,</span>
<a id="__codelineno-18-73" name="__codelineno-18-73"></a><span class="w">      </span><span class="nx">user</span><span class="p">.</span><span class="nx">hashedPassword</span><span class="p">,</span>
<a id="__codelineno-18-74" name="__codelineno-18-74"></a><span class="w">      </span><span class="s2">&quot;bcrypt&quot;</span>
<a id="__codelineno-18-75" name="__codelineno-18-75"></a><span class="w">    </span><span class="p">);</span>
<a id="__codelineno-18-76" name="__codelineno-18-76"></a>
<a id="__codelineno-18-77" name="__codelineno-18-77"></a><span class="hll"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">match</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-18-78" name="__codelineno-18-78"></a><span class="hll"><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">payload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-18-79" name="__codelineno-18-79"></a><span class="hll"><span class="w">        </span><span class="nx">sub</span><span class="o">:</span><span class="w"> </span><span class="kt">user.id</span><span class="p">,</span>
</span><a id="__codelineno-18-80" name="__codelineno-18-80"></a><span class="hll"><span class="w">        </span><span class="nx">exp</span><span class="o">:</span><span class="w"> </span><span class="kt">Math.floor</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1000</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">60</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">60</span><span class="p">,</span><span class="w"> </span><span class="c1">// Token expires in 60 minutes</span>
</span><a id="__codelineno-18-81" name="__codelineno-18-81"></a><span class="hll"><span class="w">      </span><span class="p">};</span>
</span><a id="__codelineno-18-82" name="__codelineno-18-82"></a><span class="hll"><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">secret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;mySecretKey&quot;</span><span class="p">;</span>
</span><a id="__codelineno-18-83" name="__codelineno-18-83"></a><span class="hll"><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">sign</span><span class="p">(</span><span class="nx">payload</span><span class="p">,</span><span class="w"> </span><span class="nx">secret</span><span class="p">);</span>
</span><a id="__codelineno-18-84" name="__codelineno-18-84"></a><span class="hll"><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Login successful&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">token</span><span class="o">:</span><span class="w"> </span><span class="kt">token</span><span class="w"> </span><span class="p">});</span>
</span><a id="__codelineno-18-85" name="__codelineno-18-85"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-86" name="__codelineno-18-86"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">HTTPException</span><span class="p">(</span><span class="mf">401</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Invalid credentials&quot;</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-18-87" name="__codelineno-18-87"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-18-88" name="__codelineno-18-88"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-89" name="__codelineno-18-89"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">HTTPException</span><span class="p">(</span><span class="mf">401</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Invalid credentials&#39;</span><span class="w"> </span><span class="p">})</span>
<a id="__codelineno-18-90" name="__codelineno-18-90"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-18-91" name="__codelineno-18-91"></a><span class="p">});</span>
</code></pre></div></td></tr></table></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The secret key used to sign the JWT token should be kept secure and not exposed in the code. In a production environment, you should store the secret key in an environment variable or a secure location.</p>
</div>
<h2 id="implementing-authorization-on-protected-endpoints">Implementing authorization on protected endpoints</h2>
<p>To implement authorization, we need to create a middleware that verifies the JWT token sent by the user in the Authorization header. If the token is valid, the user is authenticated and can access the protected endpoints.</p>
<h3 id="middleware-for-verifying-jwt-tokens">Middleware for verifying JWT tokens</h3>
<p>To create a middleware for verifying JWT tokens, we need to create a new function that checks the Authorization header for the JWT token. If the token is valid, the user is authenticated and can access the protected endpoints.</p>
<p>Thankfully, Hono provides a middleware function called <code>jwt</code> that verifies the JWT token and decodes the payload. The middleware function can be used to protect the endpoints that require authentication.</p>
<p>The JWT Auth Middleware provides authentication by verifying the token with JWT. Authorization header value or cookie value specified by the cookie option will be used as a token.</p>
<p>To use the JWT Auth Middleware, you can import it as follows:</p>
<div class="highlight"><span class="filename">src/index.ts</span><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Hono</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;hono&quot;</span><span class="p">;</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">cors</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;hono/cors&quot;</span><span class="p">;</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">PrismaClient</span><span class="p">,</span><span class="w"> </span><span class="nx">Prisma</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@prisma/client&quot;</span><span class="p">;</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">HTTPException</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;hono/http-exception&quot;</span><span class="p">;</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">decode</span><span class="p">,</span><span class="w"> </span><span class="nx">sign</span><span class="p">,</span><span class="w"> </span><span class="nx">verify</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;hono/jwt&quot;</span><span class="p">;</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="hll"><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">jwt</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;hono/jwt&#39;</span>
</span><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="hll"><span class="k">import</span><span class="w"> </span><span class="kr">type</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">JwtVariables</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;hono/jwt&#39;</span>
</span></code></pre></div>
<p>Specify the variable types to infer the <code>c.get('jwtPayload')</code> type.</p>
<div class="highlight"><span class="filename">src/index.ts</span><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Hono</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;hono&quot;</span><span class="p">;</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">cors</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;hono/cors&quot;</span><span class="p">;</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">PrismaClient</span><span class="p">,</span><span class="w"> </span><span class="nx">Prisma</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@prisma/client&quot;</span><span class="p">;</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">HTTPException</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;hono/http-exception&quot;</span><span class="p">;</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">decode</span><span class="p">,</span><span class="w"> </span><span class="nx">sign</span><span class="p">,</span><span class="w"> </span><span class="nx">verify</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;hono/jwt&quot;</span><span class="p">;</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">jwt</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;hono/jwt&#39;</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="k">import</span><span class="w"> </span><span class="kr">type</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">JwtVariables</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;hono/jwt&#39;</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="hll"><span class="kr">type</span><span class="w"> </span><span class="nx">Variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">JwtVariables</span>
</span><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="hll">
</span><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="hll"><span class="kd">const</span><span class="w"> </span><span class="nx">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Hono</span><span class="o">&lt;</span><span class="p">{</span><span class="w"> </span><span class="nx">Variables</span><span class="o">:</span><span class="w"> </span><span class="kt">Variables</span><span class="w"> </span><span class="p">}</span><span class="o">&gt;</span><span class="p">()</span>
</span></code></pre></div>
<p>Next, we can use the middleware function called <code>jwt</code> that verifies the JWT token sent by the user in the Authorization header.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">src/index.ts</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-17">17</a></span>
<span class="normal"><a href="#__codelineno-21-18">18</a></span>
<span class="normal"><a href="#__codelineno-21-19">19</a></span>
<span class="normal"><a href="#__codelineno-21-20">20</a></span>
<span class="normal"><a href="#__codelineno-21-21">21</a></span>
<span class="normal"><a href="#__codelineno-21-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-17" name="__codelineno-21-17"></a><span class="hll"><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span>
</span><a id="__codelineno-21-18" name="__codelineno-21-18"></a><span class="hll"><span class="w">  </span><span class="s2">&quot;/protected/*&quot;</span><span class="p">,</span>
</span><a id="__codelineno-21-19" name="__codelineno-21-19"></a><span class="hll"><span class="w">  </span><span class="nx">jwt</span><span class="p">({</span>
</span><a id="__codelineno-21-20" name="__codelineno-21-20"></a><span class="hll"><span class="w">    </span><span class="nx">secret</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;mySecretKey&#39;</span><span class="p">,</span>
</span><a id="__codelineno-21-21" name="__codelineno-21-21"></a><span class="hll"><span class="w">  </span><span class="p">})</span>
</span><a id="__codelineno-21-22" name="__codelineno-21-22"></a><span class="hll"><span class="p">);</span>
</span></code></pre></div></td></tr></table></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The secret key used to sign the JWT token should be kept secure and not exposed in the code. In a production environment, you should store the secret key in an environment variable or a secure location.</p>
</div>
<p>The middleware function <code>jwt</code> verifies the JWT token sent by the user in the Authorization header. If the token is valid, the user is authenticated and can access the protected endpoints.</p>
<h3 id="protected-endpoint">Protected endpoint</h3>
<p>The protected endpoint is a GET request that retrieves the user's account balance. The server will verify the JWT token sent by the user in the Authorization header. If the token is valid, the user is authenticated and can access the protected endpoint.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="err">GET http://localhost:3000/protected/account/balance</span>
</code></pre></div>
<h4 id="request-headers">Request Headers</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="err">Authorization</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="err">Bearer JWT</span>
</code></pre></div>
<h4 id="response_3">Response</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="p">{</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="w">    </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="w">        </span><span class="nt">&quot;Account&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="w">            </span><span class="p">{</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="w">                </span><span class="nt">&quot;balance&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="w">                </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;75a34064-f8c4-4a7e-90dd-4958c452fbf4&quot;</span>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="w">        </span><span class="p">]</span>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="p">}</span>
</code></pre></div>
<h3 id="implementing-the-protected-endpoint">Implementing the protected endpoint</h3>
<p>To implement the protected endpoint, we need to create a new route in the <code>src/index.ts</code> file.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">src/index.ts</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-17">17</a></span>
<span class="normal"><a href="#__codelineno-25-18">18</a></span>
<span class="normal"><a href="#__codelineno-25-19">19</a></span>
<span class="normal"><a href="#__codelineno-25-20">20</a></span>
<span class="normal"><a href="#__codelineno-25-21">21</a></span>
<span class="normal"><a href="#__codelineno-25-22">22</a></span>
<span class="normal"><a href="#__codelineno-25-23">23</a></span>
<span class="normal"><a href="#__codelineno-25-24">24</a></span>
<span class="normal"><a href="#__codelineno-25-25">25</a></span>
<span class="normal"><a href="#__codelineno-25-26">26</a></span>
<span class="normal"><a href="#__codelineno-25-27">27</a></span>
<span class="normal"><a href="#__codelineno-25-28">28</a></span>
<span class="normal"><a href="#__codelineno-25-29">29</a></span>
<span class="normal"><a href="#__codelineno-25-30">30</a></span>
<span class="normal"><a href="#__codelineno-25-31">31</a></span>
<span class="normal"><a href="#__codelineno-25-32">32</a></span>
<span class="normal"><a href="#__codelineno-25-33">33</a></span>
<span class="normal"><a href="#__codelineno-25-34">34</a></span>
<span class="normal"><a href="#__codelineno-25-35">35</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-25-17" name="__codelineno-25-17"></a><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span>
<a id="__codelineno-25-18" name="__codelineno-25-18"></a><span class="w">  </span><span class="s2">&quot;/protected/*&quot;</span><span class="p">,</span>
<a id="__codelineno-25-19" name="__codelineno-25-19"></a><span class="w">  </span><span class="nx">jwt</span><span class="p">({</span>
<a id="__codelineno-25-20" name="__codelineno-25-20"></a><span class="w">    </span><span class="nx">secret</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;mySecretKey&#39;</span><span class="p">,</span>
<a id="__codelineno-25-21" name="__codelineno-25-21"></a><span class="w">  </span><span class="p">})</span>
<a id="__codelineno-25-22" name="__codelineno-25-22"></a><span class="p">);</span>
<a id="__codelineno-25-23" name="__codelineno-25-23"></a>
<a id="__codelineno-25-24" name="__codelineno-25-24"></a><span class="hll"><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;/protected/account/balance&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-25-25" name="__codelineno-25-25"></a><span class="hll"><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">payload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;jwtPayload&#39;</span><span class="p">)</span>
</span><a id="__codelineno-25-26" name="__codelineno-25-26"></a><span class="hll"><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">payload</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-25-27" name="__codelineno-25-27"></a><span class="hll"><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">HTTPException</span><span class="p">(</span><span class="mf">401</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Unauthorized&quot;</span><span class="w"> </span><span class="p">});</span>
</span><a id="__codelineno-25-28" name="__codelineno-25-28"></a><span class="hll"><span class="w">  </span><span class="p">}</span>
</span><a id="__codelineno-25-29" name="__codelineno-25-29"></a><span class="hll"><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">findUnique</span><span class="p">({</span>
</span><a id="__codelineno-25-30" name="__codelineno-25-30"></a><span class="hll"><span class="w">    </span><span class="nx">where</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">payload.sub</span><span class="w"> </span><span class="p">},</span>
</span><a id="__codelineno-25-31" name="__codelineno-25-31"></a><span class="hll"><span class="w">    </span><span class="nx">select</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Account</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">select</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">balance</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
</span><a id="__codelineno-25-32" name="__codelineno-25-32"></a><span class="hll"><span class="w">  </span><span class="p">});</span>
</span><a id="__codelineno-25-33" name="__codelineno-25-33"></a><span class="hll">
</span><a id="__codelineno-25-34" name="__codelineno-25-34"></a><span class="hll"><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">user</span><span class="w"> </span><span class="p">});</span>
</span><a id="__codelineno-25-35" name="__codelineno-25-35"></a><span class="hll"><span class="p">});</span>
</span></code></pre></div></td></tr></table></div>
<ol>
<li>The middleware function <code>jwt</code> verifies the JWT token sent by the user in the Authorization header.</li>
<li>The protected endpoint listens for GET requests to the <code>/protected/account/balance</code> endpoint.</li>
<li>The middleware function <code>jwt</code> decodes the JWT token and stores the payload in the context.</li>
<li>If the JWT token is not valid, the server throws an HTTPException with a status code of 401 and a message "Unauthorized".</li>
<li>The user is fetched from the database using the user id from the JWT token.</li>
<li>The user's account balance is returned in the JSON response.</li>
</ol>







  
  






                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": ".", "features": ["navigation.tabs", "navigation.sections", "navigation.path", "toc.follow", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotate", "content.code.copy", "content.code.select"], "search": "assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>